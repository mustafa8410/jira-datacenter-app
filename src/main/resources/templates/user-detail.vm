<html>
<head>
    <title>User Activity Detail - $user.displayName</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .list-group-item {
            border: none;                      /* Remove all borders first */
            border-bottom: 1px solid #dee2e6;  /* Add separator line only below each item */
        }
        .list-group-item:last-child {
            border-bottom: none;               /* Remove border under the last item */
        }

        .clickable-li {
            cursor: pointer;
            transition: background-color 0.5s ease;
        }
        .clickable-li:hover {
            background-color: #0d6efd;  /* Bootstrap primary */
            color: white;
        }
    </style>

</head>
<body class="bg-light">
<div class="container my-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">User Activity Detail: $user.displayName ($user.username)</h4>
                <span class="badge bg-light text-dark">$isActive</span>
            </div>
        </div>
        <div class="card-body">

            <p><strong>Last Login:</strong> $lastLogin</p>
            <p><strong>Jira Groups:</strong> #foreach($g in $groups)$g #if(!$velocityCount.equals($groups.size()))| #end #end</p>
            <hr>
            <div class="row g-4 align-items-start">
                <div class="col-md-3">
                    <h5>Activity (Last 30 Days)</h5>
                    <ul>
                        <li>Assigned: $assigned30</li>
                        <li>Resolved: $resolved30</li>
                        <li>Created: $created30</li>
                        ##                <li>Comments: $comments30</li>
                    </ul>
                    <h5>All Time</h5>
                    <ul>
                        <li>Assigned: $assignedAllTime</li>
                        <li>Resolved: $resolvedAllTime</li>
                        <li>Created: $createdAllTime</li>
                    </ul>
                </div>

                <div class="col-md-5">
                    #if($warnings && $warnings.size() > 0)
                        <h5>Warnings:</h5>
                        <div class="alert alert-warning shadow-sm" role="alert">
                            <ul class="mb-0">
                                #foreach($w in $warnings)
                                    <li>$w</li>
                                #end
                            </ul>
                        </div>
                    #end
                </div>

                <div class="col-md-4">
                    <h5>Participated Projects (Last 30 Days)</h5>
                    <ul class="list-group">
                        #foreach($project in $projectsLast30Days)
                            <li class="list-group-item clickable-li"
                                data-href="$contextPath/projects/$project.projectKey">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        $project.projectName - $project.projectKey
                                    </div>
                                    <div>
                                        #foreach($role in $project.userRoles)
                                            <span class="badge bg-secondary">$role</span>
                                        #end
                                    </div>
                                </div>


                            </li>
                        #end
                    </ul>
                </div>
            </div>

            <hr>
            <div class="d-flex justify-content-between align-items-center">
                <div>
##                    <form method="post" action="$contextPath/plugins/servlet/my-plugin-user-action" style="display:inline;">
##                        <input type="hidden" name="username" value="$user.username"/>
##                        <input type="hidden" name="action" value="deactivate"/>
##                        <button class="btn btn-warning" type="submit" onclick="return confirm('Deactivate this user?');">
##                            Remove from all groups (Deactivate)
##                        </button>
##                    </form>
                    <form method="post" action="$contextPath/plugins/servlet/my-plugin-user-action" style="display:inline;">
                        <input type="hidden" name="username" value="$user.username"/>
                        <input type="hidden" name="action" value="remove-group"/>
                        <button class="btn btn-danger" type="submit" onclick="return confirm('Revoke this user\'s license?');">
                            Remove from jira-users (Revoke License)
                        </button>
                    </form>
                </div>
                <div>
                    <a href="$contextPath/plugins/servlet/my-plugin-dashboard" class="btn btn-primary">Back to Dashboard</a>
                </div>
            </div>



        </div>
    </div>
</div>
</body>
</html>



<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".clickable-li").forEach(li => {
            li.addEventListener("click", function () {
                window.open(this.dataset.href);
            });
        });
    });
</script>